# データモデル

## members（メンバー）

| カラム | 型 | 説明 |
|---|---|---|
| id | SERIAL | PK |
| name | VARCHAR | 名前 |
| qualification | ENUM | 職能（看護師 / 准看護師 / 助産師） |
| employment_type | ENUM | 雇用形態（常勤 / パート） |
| max_night_shifts | INTEGER | 月の夜勤上限回数（1〜6） |
| min_night_shifts | INTEGER | 月の夜勤確定回数（0=なし、1〜6） |
| night_shift_deduction_balance | INTEGER | 夜勤累計カウンター（8でリセット、公休-1） |
| created_at | TIMESTAMP | |
| updated_at | TIMESTAMP | |

## member_capabilities（メンバー能力フラグ）

メンバーごとの能力・資格フラグ。1メンバーに対し複数レコードが存在する。

| カラム | 型 | 説明 |
|---|---|---|
| id | SERIAL | PK |
| member_id | INTEGER | FK → members |
| capability_type | ENUM | 能力種別 |
| created_at | TIMESTAMP | |

### capability_type の値

| 値 | 説明 |
|---|---|
| outpatient_leader | 外来L可能 |
| ward_leader | 病棟L可能 |
| night_leader | 夜勤L可能 |
| day_shift | 日勤可能 |
| night_shift | 夜勤可能 |
| beauty | 美容可能 |
| mw_outpatient | MW外来可能 |
| ward_staff | 病棟担当 |
| rookie | 新人 |
| early_shift | 早番可能 |

## ng_pairs（NGペア）

夜勤で同時に組ませてはいけないメンバーの組み合わせ。member_id_1 < member_id_2 のユニーク制約。

| カラム | 型 | 説明 |
|---|---|---|
| id | SERIAL | PK |
| member_id_1 | INTEGER | FK → members |
| member_id_2 | INTEGER | FK → members |
| created_at | TIMESTAMP | |

## shift_requests（希望休）

常勤は月3日まで、パートは制限なし。

| カラム | 型 | 説明 |
|---|---|---|
| id | SERIAL | PK |
| member_id | INTEGER | FK → members |
| year_month | VARCHAR | 対象年月（例: 2026-03） |
| date | DATE | 希望休の日付 |
| request_type | ENUM | 希望種別（day_off / paid_leave） |
| created_at | TIMESTAMP | |

### request_type の値

| 値 | 説明 |
|---|---|
| day_off | 公休 |
| paid_leave | 有給 |

## schedules（月間スケジュール）

| カラム | 型 | 説明 |
|---|---|---|
| id | SERIAL | PK |
| year_month | VARCHAR | 対象年月 |
| status | ENUM | draft / published |
| created_at | TIMESTAMP | |
| updated_at | TIMESTAMP | |

## shift_assignments（シフト割り当て）

1人1日1シフト（member_id + date のユニーク制約）。

| カラム | 型 | 説明 |
|---|---|---|
| id | SERIAL | PK |
| schedule_id | INTEGER | FK → schedules |
| member_id | INTEGER | FK → members |
| date | DATE | 日付 |
| shift_type | ENUM | シフト種別 |
| is_early | BOOLEAN | 早番フラグ（平日に1名） |
| created_at | TIMESTAMP | |

### shift_type の値

| 値 | 説明 |
|---|---|
| outpatient_leader | 外来L |
| treatment_room | 処置室 |
| beauty | 美容 |
| mw_outpatient | MW外来 |
| ward_leader | 病棟L |
| ward | 病棟 |
| delivery | 分娩 |
| delivery_charge | 分娩担当 |
| night_leader | 夜勤L |
| night | 夜勤 |
| day_off | 公休 |
| paid_leave | 有給 |

## pediatric_doctor_schedules（小児科医出勤日）

この日はMW外来が2名体制になる。

| カラム | 型 | 説明 |
|---|---|---|
| id | SERIAL | PK |
| date | DATE | 出勤日 |
| created_at | TIMESTAMP | |

## ER図

```
members ──┬── 1:N ── member_capabilities
          ├── 1:N ── shift_requests
          ├── 1:N ── shift_assignments
          └── M:N ── ng_pairs（自己結合）

schedules ── 1:N ── shift_assignments

pediatric_doctor_schedules（独立テーブル）
```
