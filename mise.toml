[tools]
python = "3.14.2"
uv = "latest"

[env]
_.file = ".env"

[tasks.migrate]
description = "Run database migrations"
run = "uv run alembic upgrade head"
dir = "backend"

[tasks.migrate-gen]
description = "Generate a new migration file"
run = "uv run alembic revision --autogenerate -m '{{arg(name=\"message\")}}'"
dir = "backend"

[tasks.lint]
description = "Run linters (Ruff + mypy)"
run = [
  "uv run ruff check .",
  "uv run ruff format --check .",
  "uv run mypy ."
]
dir = "backend"

[tasks.format]
description = "Format code with Ruff"
run = [
  "uv run ruff check --fix .",
  "uv run ruff format ."
]
dir = "backend"

[tasks.dev]
description = "Start backend development server"
run = "uv run fastapi dev"
dir = "backend"

[tasks."dev:front"]
description = "Start frontend development server"
run = "npm run dev"
dir = "frontend"

[tasks."lint:front"]
description = "Run frontend linters (ESLint + TypeScript)"
run = ["npm run lint", "npx tsc --noEmit"]
dir = "frontend"

[tasks."lint:all"]
description = "Run all linters (backend + frontend)"
depends = ["lint", "lint:front"]

[tasks."build:front"]
description = "Build frontend for production"
run = "npm run build"
dir = "frontend"

[tasks.generate-api]
description = "Generate TypeScript types from OpenAPI schema (requires backend running)"
run = "npm run generate-api"
dir = "frontend"

[tasks."format:front"]
description = "Fix frontend lint issues"
run = "npx eslint --fix ."
dir = "frontend"
